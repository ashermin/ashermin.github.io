<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/avatar.jpg">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/avatar.jpg">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/avatar.jpg">
  <link rel="mask-icon" href="/images/avatar.jpg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.4.2',
    exturl: false,
    sidebar: {"position":"left","width":260,"display":"post","offset":12,"onmobile":false},
    copycode: {"enable":true,"show_result":true,"style":"default"},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":true},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="1. 创建和管理数据库1.1 模版数据库Greenplum自带有三个数据库，其中template0和template1是模版库。建库时默认使用的是template1模版库，如果使用template0需要手工指定TEMPLATE属性：postgres=# create database db1;postgres=# create database db2 TEMPLATE template0;">
<meta name="keywords" content="Greenplum">
<meta property="og:type" content="article">
<meta property="og:title" content="Greenplum数据库之DDL">
<meta property="og:url" content="http:&#x2F;&#x2F;yoursite.com&#x2F;2019&#x2F;12&#x2F;19&#x2F;Greenplum%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B9%8BDDL&#x2F;index.html">
<meta property="og:site_name" content="MIN MIN">
<meta property="og:description" content="1. 创建和管理数据库1.1 模版数据库Greenplum自带有三个数据库，其中template0和template1是模版库。建库时默认使用的是template1模版库，如果使用template0需要手工指定TEMPLATE属性：postgres=# create database db1;postgres=# create database db2 TEMPLATE template0;">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http:&#x2F;&#x2F;yoursite.com&#x2F;images&#x2F;Greenplum%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B9%8BDDL&#x2F;image-20191220152804337.png">
<meta property="og:image" content="http:&#x2F;&#x2F;yoursite.com&#x2F;images&#x2F;Greenplum%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B9%8BDDL&#x2F;image-20191220155906828.png">
<meta property="og:image" content="http:&#x2F;&#x2F;yoursite.com&#x2F;images&#x2F;Greenplum%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B9%8BDDL&#x2F;image-20191220160142061.png">
<meta property="og:image" content="http:&#x2F;&#x2F;yoursite.com&#x2F;images&#x2F;Greenplum%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B9%8BDDL&#x2F;image-20191221230538425.png">
<meta property="og:updated_time" content="2019-12-23T14:14:37.247Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http:&#x2F;&#x2F;yoursite.com&#x2F;images&#x2F;Greenplum%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B9%8BDDL&#x2F;image-20191220152804337.png">

<link rel="canonical" href="http://yoursite.com/2019/12/19/Greenplum%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B9%8BDDL/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>Greenplum数据库之DDL | MIN MIN</title>
  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?cad2a7930afd095772e571e6eab3628f";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

  <!--  -->
<link href='//fonts.googleapis.com/css?family=Kaushan+Script' rel='stylesheet' type='text/css'>
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">MIN MIN</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">BLOG</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/19/Greenplum%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B9%8BDDL/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="MIN MIN">
      <meta itemprop="description" content="即使最后没有人为你鼓掌，也要优雅地谢幕，感谢自己的认真付出。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MIN MIN">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Greenplum数据库之DDL
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-12-19 20:19:40" itemprop="dateCreated datePublished" datetime="2019-12-19T20:19:40+08:00">2019-12-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-12-23 22:14:37" itemprop="dateModified" datetime="2019-12-23T22:14:37+08:00">2019-12-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Greenplum/" itemprop="url" rel="index">
                    <span itemprop="name">Greenplum</span>
                  </a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h3 id="1-创建和管理数据库"><a href="#1-创建和管理数据库" class="headerlink" title="1. 创建和管理数据库"></a>1. 创建和管理数据库</h3><h4 id="1-1-模版数据库"><a href="#1-1-模版数据库" class="headerlink" title="1.1 模版数据库"></a>1.1 模版数据库</h4><p>Greenplum自带有三个数据库，其中<em>template0</em>和<em>template1</em>是模版库。</p><img src="/images/Greenplum%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B9%8BDDL/image-20191220152804337.png" alt="image-20191220152804337" style="zoom:50%;"><p>建库时默认使用的是<em>template1</em>模版库，如果使用<em>template0</em>需要手工指定<code>TEMPLATE</code>属性：</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">postgres=# create database db1;</span><br><span class="line">postgres=# create database db2 TEMPLATE template0;</span><br></pre></td></tr></table></figure><a id="more"></a>





<p><em>template0</em>和<em>template1</em>的区别：</p>
<ol>
<li><em>template1</em>可以连接并创建对象，但<em>template0</em>不可以。正因为<em>template1</em>可以创建对像，所以<em>template1</em>被称为非干净数据库，而<em>template0</em>被称为干净的数据库。</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">postgres=# \c template1</span><br><span class="line">You are now connected to database "template1" as user "postgres".</span><br><span class="line">template1=# create table tmp_1( id int4);</span><br><span class="line">CREATE TABLE</span><br><span class="line"></span><br><span class="line">template1=# \c template0</span><br><span class="line">FATAL:  database "template0" is not currently accepting connections</span><br><span class="line">Previous connection kept</span><br></pre></td></tr></table></figure>

<p>注：可以通过其它方法连接<em>template0</em>库，这里咱不深究。</p>
<ol start="2">
<li>使用<em>template1</em>模板库建库时不可以指定新的<code>ENCODING</code>和<code>LOCALE</code>，而<em>template0</em>可以：</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">template1=# create database db3 TEMPLATE template0 ENCODING 'SQL_ASCII' ;</span><br><span class="line">CREATE DATABASE</span><br><span class="line"></span><br><span class="line">template1=# create database db4 TEMPLATE template1 ENCODING 'SQL_ASCII' ;</span><br><span class="line">ERROR:  new encoding (SQL_ASCII) is incompatible with the encoding of the template database (UTF8)</span><br></pre></td></tr></table></figure>

<h4 id="1-2-创建数据库"><a href="#1-2-创建数据库" class="headerlink" title="1.2 创建数据库"></a>1.2 创建数据库</h4><p>语法：<code>CREATE DATABASE new_dbname;</code></p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">=&gt; CREATE DATABASE tmp_database;</span><br></pre></td></tr></table></figure>

<p>还可以使用客户端程序<code>createdb</code>来创建：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> createdb -h min01 -p 5432 tmp_database2</span></span><br></pre></td></tr></table></figure>

<p>主机名和端口必须匹配所安装的Greenplum数据库系统的主机名和端口。</p>
<p>⚠️注意：<em>CREATE DATABASE</em>命令不是事务性的。</p>
<h4 id="1-3-克隆数据库"><a href="#1-3-克隆数据库" class="headerlink" title="1.3 克隆数据库"></a>1.3 克隆数据库</h4><p>就像<code>1.1</code>那样，默认情况下，一个新数据库通过克隆标准系统数据库模板<em>template1</em>而创建。其实在创建新数据库时，任何一个数据库都可以被用作模板，这样就提供了“克隆”或者复制一个现有数据库及其所包含的所有对象和数据的能力。例如：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">=&gt; CREATE DATABASE new_dbname TEMPLATE old_dbname;</span><br></pre></td></tr></table></figure>

<h4 id="1-4-查看数据库的列表"><a href="#1-4-查看数据库的列表" class="headerlink" title="1.4 查看数据库的列表"></a>1.4 查看数据库的列表</h4><h5 id="1-4-1-通过-l元命令"><a href="#1-4-1-通过-l元命令" class="headerlink" title="1.4.1 通过\l元命令"></a>1.4.1 通过<code>\l</code>元命令</h5><p>如果用户在使用psql客户端程序，用户可以使用<code>\l</code>元命令来显示用户的Greenplum数据库系统中的数据库和模板的列表：</p>
<img src="/images/Greenplum%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B9%8BDDL/image-20191220155906828.png" alt="image-20191220155906828" style="zoom:50%;">

<h5 id="1-4-2-通过pg-database系统目录表"><a href="#1-4-2-通过pg-database系统目录表" class="headerlink" title="1.4.2 通过pg_database系统目录表"></a>1.4.2 通过<em>pg_database</em>系统目录表</h5><p>如果使用的是另一种客户端程序并且用户是超级用户，用户可以从<em>pg_database</em>系统目录表查询数据库的列表：</p>
<img src="/images/Greenplum%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B9%8BDDL/image-20191220160142061.png" alt="image-20191220160142061" style="zoom:50%;">

<h4 id="1-5-修改数据库"><a href="#1-5-修改数据库" class="headerlink" title="1.5 修改数据库"></a>1.5 修改数据库</h4><p><em>ALTER DATABASE</em>命令可以修改数据库的属性，例如拥有者、名称或者默认配置属性。</p>
<p>下面的命令会修改一个数据库的默认方案搜索路径（<em>search_path</em>配置参数）：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">=&gt; ALTER DATABASE mydatabase SET search_path TO myschema, public, pg_catalog;</span><br></pre></td></tr></table></figure>

<p>要修改一个数据库，用户必须是该数据库的拥有者或者超级用户。</p>
<h4 id="1-6-删除数据库"><a href="#1-6-删除数据库" class="headerlink" title="1.6 删除数据库"></a>1.6 删除数据库</h4><p><em>DROP DATABASE</em>命令可以删除一个数据库。它会移除该数据库的系统目录项并且删除该数据库在磁盘上的目录及其中包含的数据。</p>
<p>在删除一个数据库时，可以连接到<em>postgres</em>（或者另一个数据库）：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">=&gt; \c postgres</span><br><span class="line">=&gt; DROP DATABASE tmp_database;</span><br></pre></td></tr></table></figure>

<p>用户也可以使用客户端程序<em>dropdb</em>来删除一个数据库。</p>
<p>例如，下面的命令会用给出的主机名和端口连接到Greenplum数据库并且删除数据库<em>mydatabase</em>：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> dropdb -h min01 -p 5432 tmp_database2</span></span><br></pre></td></tr></table></figure>

<p>要删除一个数据库，用户必须是该数据库的拥有者或者超级用户，并且当用户或者其他人正连接到该数据库时不能删除它。</p>
<p>⚠️注意：删除数据库不能被撤销，因为<em>DROP DATABASE</em>命令不是事务性的。</p>
<hr>
<h3 id="2-创建和管理表空间"><a href="#2-创建和管理表空间" class="headerlink" title="2. 创建和管理表空间"></a>2. 创建和管理表空间</h3><p>一个表空间需要一个文件系统位置来存放它的数据库文件。在Greenplum数据库中，Master和每一个Segment要求不同的存储位置。一个Greenplum数据库中所有部件所需的文件系统位置集合被称作一个<em>文件空间</em>。文件空间可以被一个或者多个表空间使用。</p>
<p>通过使用表空间，管理员可以控制一个PostgreSQL安装的磁盘布局。 这么做至少有两个用处：</p>
<ol>
<li>如果初始化集群所在的分区或者卷用光了空间， 而又不能扩展，那么表空间可以在一个不同的分区上创建和使用， 直到系统可以重新配置。</li>
<li>表空间允许管理员根据数据库对象的使用模式安排数据位置，从而优化性能。比如， 一个很频繁使用的索引可以放在非常快并且非常可靠的磁盘上，比如一种非常贵的固态设备。而同时， 一个存储归档的数据，很少使用的或者对性能要求不高的表可以存储在一个便宜但比较慢的磁盘系统上。</li>
</ol>
<p>对于表空间创建和管理的实战这里不再演示，可以参考<a href="https://greenplum.cn/gp5/admin_guide/ddl/ddl-tablespace.html" target="_blank" rel="noopener">官方文档</a>。</p>
<hr>
<h3 id="3-创建和管理SCHEMA"><a href="#3-创建和管理SCHEMA" class="headerlink" title="3. 创建和管理SCHEMA"></a>3. 创建和管理SCHEMA</h3><p>有了schema，就允许出现相同名称的对象，只要对象在不同的schema中。默认schema为<em>public</em>，所有用户对其都有<code>CREATE</code>和<code>USAGE</code>权限。如果新建一个schema，需要给访问该schema的用户添加权限。</p>
<h4 id="3-1-创建SCHEMA"><a href="#3-1-创建SCHEMA" class="headerlink" title="3.1 创建SCHEMA"></a>3.1 创建SCHEMA</h4><figure class="highlight"><table><tr><td class="code"><pre><span class="line">=&gt; CREATE SCHEMA minschema;</span><br></pre></td></tr></table></figure>

<h4 id="3-2-删除SCHEMA"><a href="#3-2-删除SCHEMA" class="headerlink" title="3.2 删除SCHEMA"></a>3.2 删除SCHEMA</h4><p>默认只能删除空的schema：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">=&gt; DROP SCHEMA minschema;</span><br></pre></td></tr></table></figure>

<p>删除schema连同其中的所有对象（表、数据、函数等）：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">=&gt; DROP SCHEMA minschema CASCADE;</span><br></pre></td></tr></table></figure>

<h4 id="3-3-SCHEMA搜索顺序"><a href="#3-3-SCHEMA搜索顺序" class="headerlink" title="3.3 SCHEMA搜索顺序"></a>3.3 SCHEMA搜索顺序</h4><p>schema的搜索顺序是由<em>search_path</em>来指定的，默认第一个是<em>public</em>。</p>
<p>可以修改全局搜索顺序：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">=&gt; ALTER DATABASE mydatabase SET search_path TO minschema, </span><br><span class="line">public, pg_catalog;</span><br></pre></td></tr></table></figure>

<p>也可以只为特定用户来修改搜索顺序：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">=&gt; ALTER ROLE sally SET search_path TO minschema, public, </span><br><span class="line">pg_catalog;</span><br></pre></td></tr></table></figure>

<h4 id="3-4-查看SCHEMA"><a href="#3-4-查看SCHEMA" class="headerlink" title="3.4 查看SCHEMA"></a>3.4 查看SCHEMA</h4><p>查看当前的schema：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">=&gt; SELECT current_schema();</span><br></pre></td></tr></table></figure>

<p>查看当前的搜索路径：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">=&gt; SHOW search_path;</span><br></pre></td></tr></table></figure>

<p>查看所有的schema：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">=&gt; SELECT * FROM information_schema.schemata;</span><br></pre></td></tr></table></figure>

<img src="/images/Greenplum%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B9%8BDDL/image-20191221230538425.png" alt="image-20191221230538425" style="zoom:50%;">

<p>下列系统级schema存在于每一个数据库中：</p>
<ul>
<li>pg_catalog：包含着系统目录表、内建数据类型、函数和操作符。 </li>
<li>information_schema：有一个包含数据库中对象信息的视图集合组成。 这些视图以一种标准化的方式从系统目录表中得到系统信息。</li>
<li>pg_toast：存储大型对象，如超过页面尺寸的记录。 这个schema由Greenplum数据库系统内部使用。</li>
<li>pg_bitmapindex：存储位图索引对象，例如值的列表。 这个schema由Greenplum数据库系统内部使用。</li>
<li>pg_aoseg：存储追加优化表对象。 这个schema由Greenplum数据库系统内部使用。</li>
<li>gp_toolkit：是一个管理用途的schema，它包含用户可以用SQL命令访问的外部表、视图和函数。 所有的数据库用户都能访问gp_toolkit来查看和查询系统日志文件以及其他系统指标。</li>
</ul>
<hr>
<h3 id="4-创建和管理表"><a href="#4-创建和管理表" class="headerlink" title="4. 创建和管理表"></a>4. 创建和管理表</h3><p>Greenplum数据库表中的行是分布在系统的不同Segment上的，所以当用户创建一个表时，应该要指定该表的分布策略。</p>
<p>要创建一个表，需要对表定义如下属性：</p>
<ul>
<li>该表的列以及它们的数据类型</li>
<li>任何用于限制列或者表中能包含的数据的表或者列约束</li>
<li>表的分布策略，这决定了Greenplum数据库如何在Segment之间划分数据</li>
<li>表在磁盘上的存储模型</li>
<li>大型表的表分区策略</li>
</ul>
<h4 id="4-1-表和列约束"><a href="#4-1-表和列约束" class="headerlink" title="4.1 表和列约束"></a>4.1 表和列约束</h4><p>Greenplum数据库的约束和PostgreSQL基本相同。</p>
<h5 id="4-1-1-检查约束——CHECK"><a href="#4-1-1-检查约束——CHECK" class="headerlink" title="4.1.1 检查约束——CHECK"></a>4.1.1 检查约束——CHECK</h5><p>检查约束允许用户指定一个特定列中的值必须满足一个布尔（真值）表达式。</p>
<p>例如，要求产品价格为正数：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> products(</span><br><span class="line">  product_no <span class="built_in">integer</span>,</span><br><span class="line">  <span class="keyword">name</span> <span class="built_in">text</span>,</span><br><span class="line">  price <span class="built_in">numeric</span> <span class="keyword">CHECK</span> (price &gt; <span class="number">0</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h5 id="4-1-2-非空约束——NOT-NULL"><a href="#4-1-2-非空约束——NOT-NULL" class="headerlink" title="4.1.2 非空约束——NOT NULL"></a>4.1.2 非空约束——NOT NULL</h5><p>非空约束指定一个列不能有空值。非空约束总是被写作为列约束。例如：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> products(</span><br><span class="line">  product_no <span class="built_in">integer</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="keyword">name</span> <span class="built_in">text</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  price <span class="built_in">numeric</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h5 id="4-1-3-唯一约束——UNIQUE"><a href="#4-1-3-唯一约束——UNIQUE" class="headerlink" title="4.1.3 唯一约束——UNIQUE"></a>4.1.3 唯一约束——UNIQUE</h5><p>唯一约束确保一列或者一组列中包含的数据对于表中所有的行都是唯一的。 </p>
<p>该表必须是<strong>哈希分布</strong>或<strong>复制表</strong>，不可以是<code>DISTRIBUTED RANDOMLY</code>。如果表是哈希分布的，约束列必须是该表的分布键列（或者是一个超集）。例如：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> products(</span><br><span class="line">  product_no <span class="built_in">integer</span> <span class="keyword">UNIQUE</span>,</span><br><span class="line">  <span class="keyword">name</span> <span class="built_in">text</span>,</span><br><span class="line">  price <span class="built_in">numeric</span></span><br><span class="line">)<span class="keyword">DISTRIBUTED</span> <span class="keyword">BY</span> (product_no);</span><br></pre></td></tr></table></figure>

<h5 id="4-1-4-主键——PRIMARY-KEY"><a href="#4-1-4-主键——PRIMARY-KEY" class="headerlink" title="4.1.4 主键——PRIMARY KEY"></a>4.1.4 主键——PRIMARY KEY</h5><p>主键约束是一个<code>UNIQUE</code>约束和一个<code>NOT NULL</code>约束的组合。</p>
<p>该表必须是<strong>哈希分布</strong>（非<code>DISTRIBUTED RANDOMLY</code>）的，并且约束列必须是该表的分布键列（或者是一个超集）。 </p>
<p>如果一个表具有主键，这个列（或者这一组列）会被默认选中为该表的分布键。 例如：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> products(</span><br><span class="line">  product_no <span class="built_in">integer</span> PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">  <span class="keyword">name</span> <span class="built_in">text</span>,</span><br><span class="line">  price <span class="built_in">numeric</span></span><br><span class="line">)<span class="keyword">DISTRIBUTED</span> <span class="keyword">BY</span> (product_no);</span><br></pre></td></tr></table></figure>

<h5 id="4-1-5-外键"><a href="#4-1-5-外键" class="headerlink" title="4.1.5 外键"></a>4.1.5 外键</h5><p>不支持外键。用户可以声明它们，但是参照完整性不会被实施。</p>
<p>外键约束指定一列或者一组列中的值必须匹配出现在另一个表的某行中的值，以此来维护两个相关表之间的参照完整性。 参照完整性检查不能在一个Greenplum数据库的分布表段之间实施。</p>
<h4 id="4-2-表的分布策略"><a href="#4-2-表的分布策略" class="headerlink" title="4.2 表的分布策略"></a>4.2 表的分布策略</h4><h5 id="4-2-1-哈希分布"><a href="#4-2-1-哈希分布" class="headerlink" title="4.2.1 哈希分布"></a>4.2.1 哈希分布</h5><p>哈希分布是表的<strong>默认分布策略</strong>。语法：<code>DISTRIBUTED BY (column,[...])</code></p>
<p>如果创建表时未提供<code>DISTRIBUTED</code>子句，默认会将<strong><em>PRIMARY KEY</em></strong>或表的第一个<strong>合格列</strong>用作分布键，如果表中没有合格列，则退化为<em>随机分布策略</em>。具体根据<a href="https://gp-docs-cn.github.io/docs/ref_guide/config_params/guc-list.html#gp_create_table_random_default_distribution" target="_blank" rel="noopener"><em>gp_create_table_random_default_distribution</em></a>和使用的<em>优化器optimizer</em>来决定。</p>
<blockquote>
<p>什么类型的列是合格列？</p>
<p>几何类型或用户自定义数据类型的列不能用作Greenplum分布键列。</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> products(</span><br><span class="line">  <span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">40</span>),</span><br><span class="line">  prod_id <span class="built_in">integer</span>,</span><br><span class="line">  supplier_id <span class="built_in">integer</span></span><br><span class="line">)<span class="keyword">DISTRIBUTED</span> <span class="keyword">BY</span> (prod_id);</span><br></pre></td></tr></table></figure>

<h5 id="4-2-2-随机分布"><a href="#4-2-2-随机分布" class="headerlink" title="4.2.2 随机分布"></a>4.2.2 随机分布</h5><p>语法：<code>DISTRIBUTED RANDOMLY</code></p>
<p>随机分布会将数据行按到来顺序依次循环发送到各个segment上。与哈希分布策略不同，具有相同值的数据行不一定位于同一个segment上。虽然随机分布确保了数据的平均分布，但只要有可能，应该尽量选择哈希分布策略，哈希分布的性能更加优良。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> random_stuff(</span><br><span class="line">  things <span class="built_in">text</span>,</span><br><span class="line">  doodads <span class="built_in">text</span>,</span><br><span class="line">  etc <span class="built_in">text</span></span><br><span class="line">)<span class="keyword">DISTRIBUTED</span> RANDOMLY;</span><br></pre></td></tr></table></figure>

<h5 id="4-2-3-复制分布"><a href="#4-2-3-复制分布" class="headerlink" title="4.2.3 复制分布"></a>4.2.3 复制分布</h5><p>Greenplum6的新增特性，语法：<code>DISTRIBUTED REPLICATED</code></p>
<p>Greenplum数据库将每行数据分配到每个Segment上。这种分布策略下，表数据将均匀分布，因为每个Segment都存储着同样的数据行。</p>
<p>使用场景：</p>
<ol>
<li>需要在Segment上执行用户自定义的函数且这些函数需要访问表中的所有行时</li>
<li>当有大表与小表Join，把足够小的表指定为replicated也可能提升性能</li>
</ol>
<h4 id="4-3-表的存储模型"><a href="#4-3-表的存储模型" class="headerlink" title="4.3 表的存储模型"></a>4.3 表的存储模型</h4><h5 id="4-3-1-堆存储"><a href="#4-3-1-堆存储" class="headerlink" title="4.3.1 堆存储"></a>4.3.1 堆存储</h5><p>堆表适合较小的、经常需要被更新的表，如维度表。</p>
<p>面向行的堆表是默认的存储类型。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> foo (a <span class="built_in">int</span>, b <span class="built_in">text</span>) <span class="keyword">DISTRIBUTED</span> <span class="keyword">BY</span> (a);</span><br></pre></td></tr></table></figure>

<h5 id="4-3-2-追加优化存储"><a href="#4-3-2-追加优化存储" class="headerlink" title="4.3.2 追加优化存储"></a>4.3.2 追加优化存储</h5><p>一般应用于大型的事实表，可以消除每行中的更新可见性信息负担，这可以为每一行节约大概20字节。</p>
<p>使用<code>appendoptimized=value</code>语法来指定追加优化类型的表存储，加上后不能有UNIQUE索引。</p>
<p>创建一个不压缩的追加优化表：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> bar (a <span class="built_in">int</span>, b <span class="built_in">text</span>)</span><br><span class="line"><span class="keyword">WITH</span> (appendoptimized=<span class="literal">true</span>)</span><br><span class="line"><span class="keyword">DISTRIBUTED</span> <span class="keyword">BY</span> (a);</span><br></pre></td></tr></table></figure>

<p>⚠️注意：在追加优化表上不允许<em>UNIQUE</em>和<em>PRIMARY KEY</em>约束，因为追加优化表上不允许这些约束创建的UNIQUE索引。并且追加优化表上不允许UPDATE和DELETE</p>
<h5 id="4-3-3-面向行或面向列存储"><a href="#4-3-3-面向行或面向列存储" class="headerlink" title="4.3.3 面向行或面向列存储"></a>4.3.3 面向行或面向列存储</h5><p>面向行或面向列存储的适用场景：</p>
<ul>
<li>面向行：频繁地装载和更新表数据、频繁地向表中插入行、在查询的SELECT列表或者WHERE子句中常常要求所有或者大部分列</li>
<li>面向列：查询会聚集一个单一列中的很多值且WHERE或者HAVING谓词也在该聚集列上</li>
</ul>
<p>默认是面向行的堆表，<strong>使用面向列存储的表必须是追加优化表</strong>：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> bar(a <span class="built_in">int</span>, b <span class="built_in">text</span>)</span><br><span class="line"><span class="keyword">WITH</span> (appendoptimized=<span class="literal">true</span>, orientation=<span class="keyword">column</span>)</span><br><span class="line"><span class="keyword">DISTRIBUTED</span> <span class="keyword">BY</span> (a);</span><br></pre></td></tr></table></figure>

<h5 id="4-3-4-压缩（仅限于追加优化表）"><a href="#4-3-4-压缩（仅限于追加优化表）" class="headerlink" title="4.3.4 压缩（仅限于追加优化表）"></a>4.3.4 压缩（仅限于追加优化表）</h5><p>对于追加优化表，在Greenplum数据库中有两种类型的库内压缩可用：</p>
<ul>
<li>应用于一整个表的表级压缩</li>
<li>应用到一个指定列的列级压缩。用户可以为不同的列应用不同的列级压缩算法</li>
</ul>
<p>使用压缩技术的表必须是追加优化表。 例如，要创建一个使用zlib压缩且压缩级别为5的追加优化表：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> foo (a <span class="built_in">int</span>, b <span class="built_in">text</span>)</span><br><span class="line"><span class="keyword">WITH</span> (appendoptimized=<span class="literal">true</span>, compresstype=zlib, compresslevel=<span class="number">5</span>);</span><br></pre></td></tr></table></figure>

<p>下面的表总结了可用的压缩算法：</p>
<table>
<thead>
<tr>
<th align="left">表方向</th>
<th align="left">可用的压缩类型</th>
<th align="left">支持的算法</th>
</tr>
</thead>
<tbody><tr>
<td align="left">行</td>
<td align="left">表</td>
<td align="left">ZLIB，ZSTD和QUICKLZ</td>
</tr>
<tr>
<td align="left">列</td>
<td align="left">列和表</td>
<td align="left">RLE_TYPE，ZLIB，ZSTD和QUICKLZ</td>
</tr>
</tbody></table>
<h4 id="4-4-修改表"><a href="#4-4-修改表" class="headerlink" title="4.4 修改表"></a>4.4 修改表</h4><h5 id="4-4-1-更改分布策略"><a href="#4-4-1-更改分布策略" class="headerlink" title="4.4.1 更改分布策略"></a>4.4.1 更改分布策略</h5><p>使用<code>customer_id</code>列作为分布键在所有Segment之间重新分布表sales：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> sales <span class="keyword">SET</span> <span class="keyword">DISTRIBUTED</span> <span class="keyword">BY</span> (customer_id);</span><br></pre></td></tr></table></figure>

<h5 id="4-4-2-重新分布表的数据"><a href="#4-4-2-重新分布表的数据" class="headerlink" title="4.4.2 重新分布表的数据"></a>4.4.2 重新分布表的数据</h5><p>当表遇到了<em>数据倾斜</em>或者<em>增加Segment资源</em>的情况，需要重新分布表的数据，使用<code>REORGANIZE=TRUE</code>：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> sales <span class="keyword">SET</span> <span class="keyword">WITH</span> (REORGANIZE=<span class="literal">TRUE</span>);</span><br></pre></td></tr></table></figure>

<p>注：将表的分布策略更改为<code>DISTRIBUTED REPLICATED</code>或从<code>DISTRIBUTED REPLICATED</code>改为其它总是重新分配表数据， 即使<code>REORGANIZE=FALSE</code>也是如此。</p>
<h5 id="4-4-3-修改表的存储模型"><a href="#4-4-3-修改表的存储模型" class="headerlink" title="4.4.3 修改表的存储模型"></a>4.4.3 修改表的存储模型</h5><p><strong>表存储、压缩和行列类型只能在创建时声明</strong>。 要改变存储模型，用户必须用正确的存储选项创建一个表，再把原始表的数据载入到新表中，接着删除原始表并且把新表重命名为原始表的名称，还必须重新授权原始表上有的权限。例如：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> sales2 (<span class="keyword">LIKE</span> sales) </span><br><span class="line"><span class="keyword">WITH</span> (appendoptimized=<span class="literal">true</span>, compresstype=quicklz, compresslevel=<span class="number">1</span>, orientation=<span class="keyword">column</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> sales2 <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> sales;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> sales;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> sales2 <span class="keyword">RENAME</span> <span class="keyword">TO</span> sales;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> sales <span class="keyword">TO</span> <span class="keyword">admin</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> sales <span class="keyword">TO</span> guest;</span><br></pre></td></tr></table></figure>

<h5 id="4-4-4-为表增加压缩列"><a href="#4-4-4-为表增加压缩列" class="headerlink" title="4.4.4 为表增加压缩列"></a>4.4.4 为表增加压缩列</h5><p>向sales表中增加一个使用zlib压缩的列<code>vendor</code>：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> sales</span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">COLUMN</span> vendor <span class="built_in">int</span> <span class="keyword">DEFAULT</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">ENCODING</span> (compresstype=zlib);</span><br></pre></td></tr></table></figure>

<h4 id="4-5-删除表"><a href="#4-5-删除表" class="headerlink" title="4.5 删除表"></a>4.5 删除表</h4><p>语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> [<span class="keyword">IF</span> <span class="keyword">EXISTS</span>] table_name [<span class="keyword">CASCADE</span> | RESTRICT];</span><br></pre></td></tr></table></figure>

<ul>
<li>RESTRICT：默认。只要有任何对象依赖该表，删除时都会被拒绝</li>
<li>CASCADE：删除时，自动把那些依赖该表的对象同时删除</li>
</ul>
<p>清空表的行但不移除该表的定义：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">TRUNCATE</span> table_name;</span><br><span class="line"><span class="comment">--或--</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> table_name;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="5-分区表和索引"><a href="#5-分区表和索引" class="headerlink" title="5. 分区表和索引"></a>5. 分区表和索引</h3><p>本章节比较重要，为了不让本次笔记显得臃肿，我会另写两篇文章来详细讨论分区表和索引：</p>
<ul>
<li>《Greenplum数据库之DDL——分区表》</li>
<li>《Greenplum数据库之DDL——索引》</li>
</ul>
<hr>
<h3 id="6-视图"><a href="#6-视图" class="headerlink" title="6. 视图"></a>6. 视图</h3><p>视图就是对于一些经常使用的查询进行封装，视图表在磁盘上并没有被物理存储。</p>
<h4 id="6-1-创建视图"><a href="#6-1-创建视图" class="headerlink" title="6.1 创建视图"></a>6.1 创建视图</h4><p><code>CREATE VIEW</code>命令定义一个查询的视图。例如：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> comedies <span class="keyword">AS</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> films <span class="keyword">WHERE</span> kind = <span class="string">'comedy'</span>;</span><br></pre></td></tr></table></figure>

<p>视图会忽略存储在视图中的ORDER BY以及SORT操作。</p>
<h4 id="6-2-删除视图"><a href="#6-2-删除视图" class="headerlink" title="6.2 删除视图"></a>6.2 删除视图</h4><p><code>DROP VIEW</code>命令删除一个视图。例如：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">VIEW</span> comedies;</span><br></pre></td></tr></table></figure>

<p><code>DROP VIEW view_name CASCADE</code>命令也可以移除所有依赖的对象。 例如，如果另一个视图依赖于将要被删除的视图，这个其他的视图也将被删除。 如果没有<code>CASCADE</code>选项，这个<code>DROP VIEW</code>命令将会失败。</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Greenplum/" rel="tag"># Greenplum</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
                <a href="/2019/12/19/%E8%BF%9E%E6%8E%A5Greenplum%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="next" title="连接Greenplum数据库">
                  <i class="fa fa-chevron-left"></i> 连接Greenplum数据库
                </a>
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
                <a href="/2019/12/19/%E5%B8%B8%E7%94%A8%E7%9A%84Linux%E5%91%BD%E4%BB%A4/" rel="prev" title="常用的Linux命令">
                  常用的Linux命令 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-创建和管理数据库"><span class="nav-number">1.</span> <span class="nav-text">1. 创建和管理数据库</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-模版数据库"><span class="nav-number">1.1.</span> <span class="nav-text">1.1 模版数据库</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-创建数据库"><span class="nav-number">1.2.</span> <span class="nav-text">1.2 创建数据库</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3-克隆数据库"><span class="nav-number">1.3.</span> <span class="nav-text">1.3 克隆数据库</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-4-查看数据库的列表"><span class="nav-number">1.4.</span> <span class="nav-text">1.4 查看数据库的列表</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-4-1-通过-l元命令"><span class="nav-number">1.4.1.</span> <span class="nav-text">1.4.1 通过\l元命令</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1-4-2-通过pg-database系统目录表"><span class="nav-number">1.4.2.</span> <span class="nav-text">1.4.2 通过pg_database系统目录表</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-5-修改数据库"><span class="nav-number">1.5.</span> <span class="nav-text">1.5 修改数据库</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-6-删除数据库"><span class="nav-number">1.6.</span> <span class="nav-text">1.6 删除数据库</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-创建和管理表空间"><span class="nav-number">2.</span> <span class="nav-text">2. 创建和管理表空间</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-创建和管理SCHEMA"><span class="nav-number">3.</span> <span class="nav-text">3. 创建和管理SCHEMA</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-创建SCHEMA"><span class="nav-number">3.1.</span> <span class="nav-text">3.1 创建SCHEMA</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-删除SCHEMA"><span class="nav-number">3.2.</span> <span class="nav-text">3.2 删除SCHEMA</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-SCHEMA搜索顺序"><span class="nav-number">3.3.</span> <span class="nav-text">3.3 SCHEMA搜索顺序</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-查看SCHEMA"><span class="nav-number">3.4.</span> <span class="nav-text">3.4 查看SCHEMA</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-创建和管理表"><span class="nav-number">4.</span> <span class="nav-text">4. 创建和管理表</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-表和列约束"><span class="nav-number">4.1.</span> <span class="nav-text">4.1 表和列约束</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#4-1-1-检查约束——CHECK"><span class="nav-number">4.1.1.</span> <span class="nav-text">4.1.1 检查约束——CHECK</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-1-2-非空约束——NOT-NULL"><span class="nav-number">4.1.2.</span> <span class="nav-text">4.1.2 非空约束——NOT NULL</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-1-3-唯一约束——UNIQUE"><span class="nav-number">4.1.3.</span> <span class="nav-text">4.1.3 唯一约束——UNIQUE</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-1-4-主键——PRIMARY-KEY"><span class="nav-number">4.1.4.</span> <span class="nav-text">4.1.4 主键——PRIMARY KEY</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-1-5-外键"><span class="nav-number">4.1.5.</span> <span class="nav-text">4.1.5 外键</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-表的分布策略"><span class="nav-number">4.2.</span> <span class="nav-text">4.2 表的分布策略</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#4-2-1-哈希分布"><span class="nav-number">4.2.1.</span> <span class="nav-text">4.2.1 哈希分布</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-2-2-随机分布"><span class="nav-number">4.2.2.</span> <span class="nav-text">4.2.2 随机分布</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-2-3-复制分布"><span class="nav-number">4.2.3.</span> <span class="nav-text">4.2.3 复制分布</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-表的存储模型"><span class="nav-number">4.3.</span> <span class="nav-text">4.3 表的存储模型</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#4-3-1-堆存储"><span class="nav-number">4.3.1.</span> <span class="nav-text">4.3.1 堆存储</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-3-2-追加优化存储"><span class="nav-number">4.3.2.</span> <span class="nav-text">4.3.2 追加优化存储</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-3-3-面向行或面向列存储"><span class="nav-number">4.3.3.</span> <span class="nav-text">4.3.3 面向行或面向列存储</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-3-4-压缩（仅限于追加优化表）"><span class="nav-number">4.3.4.</span> <span class="nav-text">4.3.4 压缩（仅限于追加优化表）</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-4-修改表"><span class="nav-number">4.4.</span> <span class="nav-text">4.4 修改表</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#4-4-1-更改分布策略"><span class="nav-number">4.4.1.</span> <span class="nav-text">4.4.1 更改分布策略</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-4-2-重新分布表的数据"><span class="nav-number">4.4.2.</span> <span class="nav-text">4.4.2 重新分布表的数据</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-4-3-修改表的存储模型"><span class="nav-number">4.4.3.</span> <span class="nav-text">4.4.3 修改表的存储模型</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-4-4-为表增加压缩列"><span class="nav-number">4.4.4.</span> <span class="nav-text">4.4.4 为表增加压缩列</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-5-删除表"><span class="nav-number">4.5.</span> <span class="nav-text">4.5 删除表</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-分区表和索引"><span class="nav-number">5.</span> <span class="nav-text">5. 分区表和索引</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-视图"><span class="nav-number">6.</span> <span class="nav-text">6. 视图</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#6-1-创建视图"><span class="nav-number">6.1.</span> <span class="nav-text">6.1 创建视图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-2-删除视图"><span class="nav-number">6.2.</span> <span class="nav-text">6.2 删除视图</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="site-author-image" itemprop="image" alt="MIN MIN"
    src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">MIN MIN</p>
  <div class="site-description" itemprop="description">即使最后没有人为你鼓掌，也要优雅地谢幕，感谢自己的认真付出。</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">64</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">13</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">33</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/ashermin" title="GitHub &amp;rarr; https:&#x2F;&#x2F;github.com&#x2F;ashermin" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 2019 – 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user-circle"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">MIN MIN</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
</div>












        
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
<script src="/js/utils.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script>



  


















  

  

  

</body>
</html>
